@model IList<CentreAffaire.Models.ChargeAffaire>
@{
    ViewBag.Title = "ListCharge";
}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<link href="https://cdn.datatables.net/1.10.15/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/responsive/2.1.1/css/responsive.bootstrap.min.css" rel="stylesheet" />

<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.15/js/dataTables.bootstrap4.min.js "></script>
<!--
<link href="css/addons-pro/steppers.css" rel="stylesheet">
<link href="css/addons-pro/steppers.min.css" rel="stylesheet">

<script type="text/javascript" src="js/addons-pro/stepper.js"></script>
<script type="text/javascript" src="js/addons-pro/stepper.min.js"></script>
-->
<div>

    <table id="demoGrid" class="table  table table-hover dt-responsive nowrap" width="100%" cellspacing="0">

        <thead>
            <tr class="styleHeaderTab">
                <th class="th-sm">
                    Matricule
                </th>
                <th class="th-sm">
                    Intitulé
                </th>
                <th class="th-sm">
                    Nombre de compte
                </th>
                <th class="">

                </th>


            </tr>
        </thead>
        @foreach (var obj in Model)
        {
            <tr>
                <td>@obj.matricule</td>
                <td>@obj.intitule</td>
                <td> 59</td>
                <td id="linkContainer">
                    <a class="cls no-href" id="detail" onclick="update_url('consulter/@obj.id')" data-toggle="modal" data-target="#exampleModal" nameOfCharge='@obj.intitule'>consulter</a>
                    <br/>
                    <a class="no-href" id="interim" onclick="startInterim(@obj.id)" data-toggle="modal" data-target="#listeCompte">Ajouter un intérimaire</a>
                    <br/>
                    <a class="no-href" id="ajout"  onclick="updateAction(@obj.id)" data-toggle="modal" data-target="#ajoutModal">Ajouter un compte</a>
                </td>

            </tr>
        }

    </table>
    <!--modal consulter -->
    <div class="modal fade modalStyle" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="update_urlClose()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="exampleModalLabel">Liste des comptes du chargé <span id="name"></span></h3>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr class="styleHeaderTab">
                                <th scope="col">Code agence</th>
                                <th scope="col">Numéro de compte</th>
                                <th scope="col">Intitulé</th>
                                <th scope="col">Intérimaire</th>
                                <!--<th scope="col">Action</th>-->
                            </tr>
                        </thead>
                        <tbody id="rowHolder"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Retour</button>

                </div>
            </div>
        </div>
    </div>
    <!--modal liste compte -->
    <div class="modal fade modalStyle" id="listeCompte" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                  
                    <span class="circle">1</span>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="update_urlClose()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="exampleModalLabel">Liste des comptes du chargé <span id="name"></span></h3>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr class="styleHeaderTab">
                                <th scope="col">
                                    <input onclick="checkAll()" type="checkbox" class="form-check-input" id="allCheck">
                                    <label class="form-check-label" for="allCheck">Sélectionner tout</label>
                                </th>
                                <th scope="col">Code agence</th>
                                <th scope="col">Numéro de compte</th>
                                <th scope="col">Intitulé</th>

                            </tr>
                        </thead>
                        <tbody id="rowHolder2"></tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Retour</button>
                    <button id ="secondScreen" data-toggle="modal" data-target="#listeInterimaire" type="button" class="btn btn-primary" data-dismiss="modal">Suivant</button>

                </div>
            </div>
        </div>
    </div>

    <!--modal liste interimaire -->
    <div class="modal fade modalStyle" id="listeInterimaire" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="update_urlClose()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="listeInterimaireLabel">Choisir un intérimaire <span id="name"></span></h3>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr class="styleHeaderTab">
                                <th scope="col"></th>
                                <th scope="col">Matricule</th>
                                <th scope="col">Intitulé</th>

                            </tr>
                        </thead>
                        <tbody id="rowHolder3"></tbody>
                        <tbody>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>123598</td>
                                <td>Mongia Chérif</td>
                            </tr>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>589648</td>
                                <td>Mohamed ben Mohamed</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>

                    <button data-toggle="modal" data-target="#exampleModal" type="button" class="btn btn-primary" data-dismiss="modal">Affecter</button>

                </div>
            </div>
        </div>
    </div>

    <!--modal Changement affectation -->
    <div class="modal fade modalStyle" id="changementAffectation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="update_urlClose()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="exampleModalLabel">Choisir un autre chargé <span id="name"></span></h3>
                </div>
                <div class="modal-body">
                    <table class="table table-hover">
                        <thead>
                            <tr class="styleHeaderTab">
                                <th scope="col"></th>
                                <th scope="col">Matricule</th>
                                <th scope="col">Intitulé</th>

                            </tr>
                        </thead>
                        <!-- <tbody id="rowHolder2"></tbody>-->
                        <tbody>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>123598</td>
                                <td>Mongia Chérif</td>
                            </tr>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>589648</td>
                                <td>Mohamed ben Mohamed</td>
                            </tr>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>256988</td>
                                <td>Mohamed Gouider</td>
                            </tr>
                            <tr>
                                <td><input type="radio" name="optradio"></td>
                                <td>698777</td>
                                <td>Amir ben Mohamed</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>

                    <button data-toggle="modal" data-target="#exampleModal" type="button" class="btn btn-primary" data-dismiss="modal">Affecter</button>

                </div>
            </div>
        </div>
    </div>


    <!--modal Ajout compte -->
    <div class="modal fade modalStyle" id="ajoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document" style="width:500px;margin-top:150px;">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="update_urlClose()">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h3 class="modal-title" id="ajoutModalLabel">Ajouter un compte</h3>
                </div>
                <form method="POST" action="Ajouter">
                    <div class="modal-body flexbox-modal">
                        <div class="flexbox-modal-child">
                            <span style="height:32px;">Code agence</span>
                            <span style="height:32px;">Numéro de compte</span>
                            <span style="height:32px;">Intitulé</span>
                        </div>
                        <div class="flexbox-modal-child">
                            <span style="height:30px;">
                                <input id="codeAgence" name="codeAgence" type="text" style="width:30px;">
                            </span>
                            <span style="height:30px;">
                                <input id="numCompte" name="numCompte" type="text" style="width:100px;">
                            </span>
                            <span style="height:30px;">
                                <input id="intitule" name="intitule" type="text" style="width:100px;">
                            </span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>

                        <input class="btn btn-primary" type="submit" value="Ajouter">
                    </div>
                </form>
            </div>
        </div>
    </div>
        <!-- Modal Supression Compte -->
    <div class="modal fade" id="SuppressionCompte" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" style="width:350px;height:350px;margin-top:150px;">
            <div class="modal-content">
                <div class="modal-header">

                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <div>
                        <h5 class="modal-title" id="exampleModalLabel" style="margin-top:20px;margin-bottom:50px;">Voulez-vous vraiment supprimer ce compte?</h5>
                        <center>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                            <button id="SupprimerBtn" type="button" class="btn btn-danger">Supprimer</button>
                        </center>

                    </div>
                </div>



            </div>
        </div>
    </div>

</div>

<script>

    $('#demoGrid').dataTable({
        "language": {
            "search": "Rechercher",
            "lengthMenu": "Afficher _MENU_ chargés par page",
            "info": "Page: _PAGE_ / _PAGES_",
            "paginate": {
                "next": "Suivante",
                "previous": "Précédente"
            }
        }
    });
</script>
<script>
    function getData() { 
        var pathArray = window.location.pathname.split('/');
        var secondLevelLocation = pathArray[3];
        
        $.ajax({
            
            url: "/ChargeAffaire/consulter/" + secondLevelLocation,
            method: 'post',
            dataType: 'json',
            error: (err) => console.log(err),
            success: function (csResponse) {
                
                //let name = $(".cls:eq("+secondLevelLocation+")").attr("nameOfCharge");
                //console.log(name);
                //$("#name").text(name);
                let s = "";
                console.log(csResponse);
                if (csResponse.length !== 0){

                    for (let i=0;i<csResponse.length;i++){
                                s += "<tr>"
                                +"<td>"+csResponse[i].codeAgence+"</td>"
                                +"<td>"+csResponse[i].numeroCompte+"</td>"
                                +"<td>"+csResponse[i].intitule+"</td>"
                                +"<td>"+csResponse[i].interimaire.intitule+"</td>"
                                +"<td>"
                                    +'<a class="no-href" onclick="f('+csResponse[i].charge.id+','+csResponse[i].id+')" data-toggle="modal" data-target="#SuppressionCompte">Supprimer compte</a>'
                                    +"<br/>"
                                    + "<a href='#'>Changer affectation</a>"
                                +"</td>"
                                +"</tr>";
                    }
                }
                    
                $("#rowHolder").html(s);
                $(".no-href").css({"cursor":"pointer","color":"#077bb1"});
                $(".no-href").parent().css("text-align","center");

            }
        
            
        });
    }
    function f(idCharge,idCompte) {
        $("#SupprimerBtn").click(() => window.location.href = "Supprimer/"+idCharge+"?idCompte="+idCompte);
    }

    function update_url(url) {
        history.pushState(null, null, url);
        getData();
    }
    function update_urlClose()
    {
        history.pushState(null, null, "/ChargeAffaire/ListCharge");
    }
    $(".modal").click(update_urlClose);
    function updateAction(id) {
        $("form").get(0).setAttribute("action","Ajouter/"+id);
    }

    function startInterim(id){
        history.pushState(null,null,"CheckComptes/"+id);
        $("#allCheck").prop("checked",false);
        $("#secondScreen").click(() => selectInterim(id));
        $.ajax({
            url:"/ChargeAffaire/CheckComptes/"+id,
            method: 'post',
            dataType: 'json',
            error: (err) => consolelog(err),
            success: (res) =>   {
                let s = "";
                for (let i=0;i<res.length;i++){
                    s+= '<tr>'
                            +'<td>'
                                +'<input value="'+ res[i].id +'"type="checkbox" class="checkChild form-check-input" id="exampleCheck1">'
                                +'<label class="form-check-label" for="exampleCheck1"></label>'
                            +'</td>'
                            +'<td>'
                                +res[i].codeAgence
                            +'</td>'
                            +'<td>'
                                +res[i].numeroCompte
                            +'</td>'
                            +'<td>'
                                +res[i].intitule
                            +'</td>'
                        +'</tr>';
                }
                $("#rowHolder2").html(s);
            }
            
        });
    }
    function checkAll() {
        let state = $("#allCheck").prop("checked");
        //console.log(state);
        $(".checkChild").prop("checked",state);
    }

    function selectInterim(id) {
        history.pushState(null,null,"checkInterim/"+id);
        

        $("#thirdScreen").click(() => alert("done"));

        $.ajax({
            url:"/ChargeAffaire/checkInterim/"+id,
            method: 'post',
            dataType: 'json',
            error: (err) => consolelog(err),
            success: (res) =>   {
                //console.log(res);
                let s = "";
                for (let i=0;i<res.length;i++){
                    s+= '<tr>'
                            +'<td>'
                                +'<input type="radio" name="optradio">'
                            +'</td>'
                            +'<td>'
                                +res[i].matricule
                            +'</td>'
                            +'<td>'
                                +res[i].intitule
                            +'</td>'
                        +'</tr>';
                }
                $("#rowHolder3").html(s);
            }
        });
    }
    $(".no-href").css({"cursor":"pointer","color":"#077bb1"});
    $(".no-href").parent().css("text-align","center");
    

</script>